<!-- Theme Color Widget Component -->
<style>
    /* Theme Color Widget Styles */
    .theme-color-widget {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
        transform: translateX(300px);
        opacity: 0;
        width: 280px;
    }
    
    .theme-color-widget.active {
        transform: translateX(0);
        opacity: 1;
    }
    
    .theme-toggle-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10001;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--ios-purple), var(--ios-pink));
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(88, 86, 214, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .theme-toggle-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 12px 32px rgba(88, 86, 214, 0.4);
    }
    
    .theme-toggle-btn.active {
        transform: rotate(45deg);
    }
    
    .theme-widget-header {
        display: flex;
        align-items: center;
        justify-content: between;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--ios-border);
    }
    
    .theme-widget-header h5 {
        margin: 0;
        color: var(--ios-text-primary);
        font-weight: 700;
        font-size: 16px;
        flex: 1;
    }
    
    .theme-widget-close {
        background: none;
        border: none;
        color: var(--ios-text-secondary);
        font-size: 18px;
        cursor: pointer;
        padding: 4px;
        border-radius: 8px;
        transition: all 0.2s ease;
    }
    
    .theme-widget-close:hover {
        background: var(--ios-background);
        color: var(--ios-text-primary);
    }
    
    .color-preset {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .color-preset-item {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .color-preset-item:hover {
        transform: scale(1.1);
        border-color: rgba(255, 255, 255, 0.5);
    }
    
    .color-preset-item.active {
        border-color: var(--ios-blue);
        transform: scale(1.05);
    }
    
    .color-preset-item::after {
        content: 'âœ“';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .color-preset-item.active::after {
        opacity: 1;
    }
    
    .custom-color-section {
        margin-bottom: 20px;
    }
    
    .custom-color-label {
        display: block;
        color: var(--ios-text-primary);
        font-weight: 600;
        margin-bottom: 12px;
        font-size: 14px;
    }
    
    .custom-color-input {
        width: 100%;
        height: 48px;
        border: 2px solid var(--ios-border);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .custom-color-input:hover {
        border-color: var(--ios-blue);
        transform: scale(1.02);
    }
    
    .theme-actions {
        display: flex;
        gap: 8px;
    }
    
    .theme-action-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
    }
    
    .theme-action-reset {
        background: rgba(255, 59, 48, 0.1);
        color: var(--ios-red);
    }
    
    .theme-action-reset:hover {
        background: rgba(255, 59, 48, 0.2);
        transform: translateY(-2px);
    }
    
    .theme-action-save {
        background: linear-gradient(135deg, var(--ios-green), #30D158);
        color: white;
    }
    
    .theme-action-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(52, 199, 89, 0.3);
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .theme-color-widget {
            top: 10px;
            right: 10px;
            left: 10px;
            width: auto;
            transform: translateY(-100vh);
        }
        
        .theme-color-widget.active {
            transform: translateY(0);
        }
        
        .theme-toggle-btn {
            top: 10px;
            right: 10px;
            width: 48px;
            height: 48px;
            font-size: 18px;
        }
        
        .color-preset {
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .color-preset-item {
            width: 40px;
            height: 40px;
        }
    }
    
    /* Smooth transitions for theme changes */
    * {
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
</style>

<!-- Theme Color Widget -->
<button class="theme-toggle-btn" id="themeToggleBtn" onclick="toggleThemeWidget()">
    <i class="fas fa-palette"></i>
</button>

<div class="theme-color-widget" id="themeColorWidget">
    <div class="theme-widget-header">
        <h5><i class="fas fa-palette me-2"></i>Theme Colors</h5>
        <button class="theme-widget-close" onclick="closeThemeWidget()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="color-preset">
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #667eea, #764ba2);" 
             data-bg="#667eea" 
             onclick="applyThemeColor('#667eea', this)"
             title="Purple Gradient">
        </div>
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #F2F2F7, #E5E5EA);" 
             data-bg="#F2F2F7" 
             onclick="applyThemeColor('#F2F2F7', this)"
             title="Light Gray (Default)">
        </div>
        
        
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB);" 
             data-bg="#E3F2FD" 
             onclick="applyThemeColor('#E3F2FD', this)"
             title="Light Blue">
        </div>
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7);" 
             data-bg="#F3E5F5" 
             onclick="applyThemeColor('#F3E5F5', this)"
             title="Light Purple">
        </div>
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #E8F5E8, #C8E6C9);" 
             data-bg="#E8F5E8" 
             onclick="applyThemeColor('#E8F5E8', this)"
             title="Light Green">
        </div>
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2);" 
             data-bg="#FFF3E0" 
             onclick="applyThemeColor('#FFF3E0', this)"
             title="Light Orange">
        </div>
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2);" 
             data-bg="#FFEBEE" 
             onclick="applyThemeColor('#FFEBEE', this)"
             title="Light Pink">
        </div>
        <div class="color-preset-item" 
             style="background: linear-gradient(135deg, #F9FBE7, #F0F4C3);" 
             data-bg="#F9FBE7" 
             onclick="applyThemeColor('#F9FBE7', this)"
             title="Light Yellow">
        </div>
    </div>
    
    <div class="custom-color-section">
        <label class="custom-color-label">Custom Background Color</label>
        <input type="color" 
               class="custom-color-input" 
               id="customColorInput" 
               value="#F2F2F7" 
               onchange="applyCustomColor(this.value)">
    </div>
    
    <div class="theme-actions">
        <button class="theme-action-btn theme-action-reset" onclick="resetThemeColor()">
            <i class="fas fa-undo me-1"></i>Reset
        </button>
        <button class="theme-action-btn theme-action-save" onclick="saveThemeColor()">
            <i class="fas fa-save me-1"></i>Save
        </button>
    </div>
</div>

<script>
// Global Theme Color Widget Functions
window.HelixBridgeTheme = {
    init: function() {
        this.loadSavedThemeColor();
        this.bindEvents();
    },
    
    bindEvents: function() {
        // Close theme widget when clicking outside
        document.addEventListener('click', function(e) {
            const widget = document.getElementById('themeColorWidget');
            const toggleBtn = document.getElementById('themeToggleBtn');
            
            if (widget && toggleBtn && 
                !widget.contains(e.target) && 
                !toggleBtn.contains(e.target) && 
                widget.classList.contains('active')) {
                closeThemeWidget();
            }
        });
    },
    
    loadSavedThemeColor: function() {
        const savedColor = localStorage.getItem('helixBridgeThemeColor');
        if (savedColor) {
            applyThemeColor(savedColor, document.querySelector(`[data-bg="${savedColor}"]`));
        }
    }
};

function toggleThemeWidget() {
    const widget = document.getElementById('themeColorWidget');
    const toggleBtn = document.getElementById('themeToggleBtn');
    
    widget.classList.toggle('active');
    toggleBtn.classList.toggle('active');
}

function closeThemeWidget() {
    const widget = document.getElementById('themeColorWidget');
    const toggleBtn = document.getElementById('themeToggleBtn');
    
    widget.classList.remove('active');
    toggleBtn.classList.remove('active');
}

function applyThemeColor(color, element) {
    // Update CSS custom property for background
    const gradientColor = `linear-gradient(135deg, ${color} 0%, ${color} 100%)`;
    document.documentElement.style.setProperty('--ios-background', gradientColor);
    
    // Update body background
    document.body.style.background = gradientColor;
    
    // Update various container backgrounds
    const containers = [
        // '.mapper-container',
        // '.dashboard-container',
        // '.container-fluid',
        // 'body'
    ];
    
    containers.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(el => {
            if (el) el.style.background = gradientColor;
        });
    });
    
    // Update active preset indicator
    document.querySelectorAll('.color-preset-item').forEach(item => {
        item.classList.remove('active');
    });
    if (element) {
        element.classList.add('active');
    }
    
    // Update custom color input
    const customInput = document.getElementById('customColorInput');
    if (customInput) {
        customInput.value = color;
    }
    
    // Store current color for saving
    window.currentThemeColor = color;
    
    // Show notification
    // showThemeNotification('Theme color applied!', 'success');
}

function applyCustomColor(color) {
    applyThemeColor(color, null);
}

function resetThemeColor() {
    const defaultColor = '#F2F2F7';
    applyThemeColor(defaultColor, document.querySelector(`[data-bg="${defaultColor}"]`));
    showThemeNotification('Theme reset to default', 'info');
}

function saveThemeColor() {
    const currentColor = window.currentThemeColor || '#F2F2F7';
    localStorage.setItem('helixBridgeThemeColor', currentColor);
    showThemeNotification('Theme color saved!', 'success');
}

function showThemeNotification(message, type) {
    // Remove existing theme notifications
    const existing = document.querySelectorAll('.theme-notification');
    existing.forEach(notif => notif.remove());
    
    const notification = document.createElement('div');
    notification.className = 'theme-notification';
    notification.style.cssText = `
        position: fixed;
        top: 90px;
        right: 20px;
        background: white;
        border-radius: 12px;
        padding: 12px 20px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        border: 1px solid var(--ios-border);
        z-index: 10002;
        font-size: 14px;
        font-weight: 600;
        color: ${type === 'success' ? 'var(--ios-green)' : type === 'info' ? 'var(--ios-blue)' : 'var(--ios-text-primary)'};
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        max-width: 250px;
    `;
    
    const icon = type === 'success' ? 'fas fa-check-circle' : 
                 type === 'info' ? 'fas fa-info-circle' : 
                 'fas fa-exclamation-circle';
    
    notification.innerHTML = `
        <i class="${icon}" style="margin-right: 8px;"></i>
        ${message}
    `;
    
    document.body.appendChild(notification);
    
    // Trigger animation
    setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Auto remove
    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => notification.remove(), 300);
        }
    }, 3000);
}

// Initialize theme widget when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    if (window.HelixBridgeTheme) {
        window.HelixBridgeTheme.init();
    }
});
</script>
